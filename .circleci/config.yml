version: 2.1
jobs:
  build:
    docker:
       - image: circleci/python:3.6.4
    steps:
      - checkout
      - run:
          command: python3 test.py
          name: Test

      - setup_remote_docker
      # build and push Docker image
      - run: |
          TAG=0.1.$CIRCLE_BUILD_NUM
          docker build -t josuepadilla/tweeter-test:$TAG .
          echo $DOCKER_PASS | docker login -u $DOCKER_USER --password-stdin
          docker push josuepadilla/tweeter-test:$TAG
      - run:
          name: Deploy Over SSH
          command: |
            ssh ieri@159.65.108.242 "docker stop tweeter;docker rm tweeter; docker run -d -p 80:80 --name tweeter josuepadilla/tweeter-test:$TAG"
          
